{% comment %}
  Testimonials section with customizable layout and styling
{% endcomment %}

<section class="testimonials testimonials--{{ section.settings.layout }} section-{{ section.id }}" {{ section.shopify_attributes }}>
  <div class="testimonials__container">
    {% if section.settings.heading != blank %}
      <div class="testimonials__header">
        <h2 class="testimonials__heading">{{ section.settings.heading }}</h2>
        {% if section.settings.subheading != blank %}
          <p class="testimonials__subheading">{{ section.settings.subheading }}</p>
        {% endif %}
      </div>
    {% endif %}
    
    <div class="testimonials__grid">
      {% for block in section.blocks %}
        <div class="testimonial testimonial--order-{{ block.settings.element_order }}" {{ block.shopify_attributes }}>
          {% assign elements = block.settings.element_order | split: '-' %}
          
          {% for element in elements %}
            {% case element %}
              {% when 'rating' %}
                {% if block.settings.show_rating and block.settings.rating > 0 %}
                  <div class="testimonial__rating">
                    {% for i in (1..5) %}
                      <span class="star {% if i <= block.settings.rating %}star--filled{% endif %}">★</span>
                    {% endfor %}
                  </div>
                {% endif %}
              
              {% when 'quote' %}
                {% if block.settings.show_quote and block.settings.quote != blank %}
                  <blockquote class="testimonial__quote">
                    "{{ block.settings.quote }}"
                  </blockquote>
                {% endif %}
              
              {% when 'author' %}
                {% if block.settings.show_author %}
                  <div class="testimonial__author">
                    {% if block.settings.show_image and block.settings.image %}
                      <img src="{{ block.settings.image | image_url: width: 60 }}" alt="{{ block.settings.name }}" class="testimonial__image">
                    {% endif %}
                    <div class="testimonial__details">
                      {% if block.settings.show_name and block.settings.name != blank %}
                        <h4 class="testimonial__name">{{ block.settings.name }}</h4>
                      {% endif %}
                      {% if block.settings.show_title and block.settings.title != blank %}
                        <p class="testimonial__title">{{ block.settings.title }}</p>
                      {% endif %}
                    </div>
                  </div>
                {% endif %}
            {% endcase %}
          {% endfor %}
        </div>
      {% endfor %}
    </div>
  </div>
</section>

<style>
  {% render 'layout-css', section: section %}
</style>

<style>
  .testimonials {
    padding: 4rem 2rem;
    background-color: {{ section.settings.background_color | default: '#f8f9fa' }};
  }
  
  .testimonials__container {
    max-width: 1200px;
    margin: 0 auto;
  }
  
  .testimonials__header {
    text-align: center;
    margin-bottom: 3rem;
  }
  
  .testimonials__heading {
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 1rem;
    color: {{ section.settings.heading_color | default: '#333' }};
  }
  
  .testimonials__subheading {
    font-size: 1.1rem;
    color: #666;
  }
  
  .testimonials__grid {
    display: grid;
    gap: 2rem;
  }
  
  .testimonials--single .testimonials__grid {
    grid-template-columns: 1fr;
    max-width: 600px;
    margin: 0 auto;
  }
  
  .testimonials--two .testimonials__grid {
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  }
  
  .testimonials--three .testimonials__grid {
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  }
  
  .testimonial {
    background: white;
    padding: 2rem;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    text-align: center;
  }
  
  .testimonial__rating {
    margin-bottom: 1rem;
  }
  
  .star {
    color: #ddd;
    font-size: 1.2rem;
  }
  
  .star--filled {
    color: #ffc107;
  }
  
  .testimonial__quote {
    font-size: 1.1rem;
    font-style: italic;
    margin: 0 0 1.5rem 0;
    color: #333;
    line-height: 1.6;
  }
  
  .testimonial__author {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 1rem;
  }
  
  .testimonial__image {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    object-fit: cover;
  }
  
  .testimonial__details {
    text-align: left;
  }
  
  .testimonial__name {
    font-weight: 600;
    margin: 0 0 0.25rem 0;
    color: #333;
  }
  
  .testimonial__title {
    font-size: 0.9rem;
    color: #666;
    margin: 0;
  }
  
  @media (max-width: 768px) {
    .testimonials { padding: 2rem 1rem; }
    .testimonials__heading { font-size: 2rem; }
    .testimonial__author { flex-direction: column; text-align: center; }
    .testimonial__details { text-align: center; }
  }
</style>

{% schema %}
{
  "name": "Testimonials",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Section Heading",
      "default": "What Our Customers Say"
    },
    {
      "type": "textarea",
      "id": "subheading",
      "label": "Section Subheading",
      "default": "Don't just take our word for it"
    },
    {
      "type": "select",
      "id": "layout",
      "label": "Layout",
      "options": [
        { "value": "single", "label": "Single Column" },
        { "value": "two", "label": "Two Columns" },
        { "value": "three", "label": "Three Columns" }
      ],
      "default": "three"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background Color",
      "default": "#f8f9fa"
    },
    {
      "type": "color",
      "id": "heading_color",
      "label": "Heading Color",
      "default": "#333333"
    },
    {
      "type": "header",
      "content": "Layout & Spacing"
    },
    {
      "type": "select",
      "id": "section_width",
      "options": [
        {
          "value": "full-width",
          "label": "Full width"
        },
        {
          "value": "page-width",
          "label": "Page width"
        },
        {
          "value": "narrow",
          "label": "Narrow"
        },
        {
          "value": "wide",
          "label": "Wide"
        }
      ],
      "default": "page-width",
      "label": "Section width"
    },
    {
      "type": "select",
      "id": "content_alignment",
      "options": [
        {
          "value": "left",
          "label": "Left"
        },
        {
          "value": "center",
          "label": "Center"
        },
        {
          "value": "right",
          "label": "Right"
        }
      ],
      "default": "left",
      "label": "Content alignment"
    }
  ],
  "blocks": [
    {
      "type": "testimonial",
      "name": "Testimonial",
      "settings": [
        {
          "type": "textarea",
          "id": "quote",
          "label": "Quote",
          "default": "This product exceeded my expectations!"
        },
        {
          "type": "text",
          "id": "name",
          "label": "Customer Name",
          "default": "John Doe"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Customer Title/Location",
          "default": "Verified Buyer"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Customer Photo"
        },
        {
          "type": "range",
          "id": "rating",
          "min": 0,
          "max": 5,
          "step": 1,
          "label": "Star Rating",
          "default": 5
        },
        {
          "type": "header",
          "content": "Element Visibility"
        },
        {
          "type": "checkbox",
          "id": "show_rating",
          "label": "Show Rating",
          "default": true
        },
        {
          "type": "checkbox",
          "id": "show_quote",
          "label": "Show Quote",
          "default": true
        },
        {
          "type": "checkbox",
          "id": "show_author",
          "label": "Show Author Section",
          "default": true
        },
        {
          "type": "checkbox",
          "id": "show_image",
          "label": "Show Customer Photo",
          "default": true
        },
        {
          "type": "checkbox",
          "id": "show_name",
          "label": "Show Customer Name",
          "default": true
        },
        {
          "type": "checkbox",
          "id": "show_title",
          "label": "Show Customer Title",
          "default": true
        },
        {
          "type": "header",
          "content": "Element Order"
        },
        {
          "type": "select",
          "id": "element_order",
          "label": "Element Display Order",
          "options": [
            { "value": "rating-quote-author", "label": "Rating → Quote → Author" },
            { "value": "quote-rating-author", "label": "Quote → Rating → Author" },
            { "value": "author-rating-quote", "label": "Author → Rating → Quote" },
            { "value": "author-quote-rating", "label": "Author → Quote → Rating" },
            { "value": "rating-author-quote", "label": "Rating → Author → Quote" },
            { "value": "quote-author-rating", "label": "Quote → Author → Rating" }
          ],
          "default": "rating-quote-author"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Testimonials",
      "blocks": [
        {
          "type": "testimonial",
          "settings": {
            "quote": "Amazing quality and fast shipping!",
            "name": "Sarah Johnson",
            "title": "Verified Buyer",
            "rating": 5
          }
        },
        {
          "type": "testimonial", 
          "settings": {
            "quote": "Excellent customer service and great products.",
            "name": "Michael Chen",
            "title": "Repeat Customer",
            "rating": 5
          }
        },
        {
          "type": "testimonial",
          "settings": {
            "quote": "I highly recommend this store to everyone!",
            "name": "Emily Davis",
            "title": "Happy Customer",
            "rating": 5
          }
        }
      ]
    }
  ]
}
{% endschema %}