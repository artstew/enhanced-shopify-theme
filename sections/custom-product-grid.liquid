{{ 'product-grid.css' | asset_url | stylesheet_tag }}

{%- liquid
  assign products_per_row = section.settings.products_per_row
  assign show_vendor = section.settings.show_vendor
  assign show_rating = section.settings.show_rating
  assign show_price = section.settings.show_price
  assign show_compare_price = section.settings.show_compare_price
  assign show_quick_buy = section.settings.show_quick_buy
  assign image_ratio = section.settings.image_ratio
-%}

<div class="product-grid-section section-{{ section.id }}-padding">
  <div class="page-width">
    {%- if section.settings.title != blank -%}
      <div class="title-wrapper-with-link title-wrapper--self-padded-mobile title-wrapper--no-top-margin">
        <h2 id="SectionHeading-{{ section.id }}" class="title inline-richtext {{ section.settings.heading_size }}">
          {{ section.settings.title }}
        </h2>
        
        {%- if section.settings.description != blank -%}
          <div class="product-grid-section__description rte">
            {{ section.settings.description }}
          </div>
        {%- endif -%}
      </div>
    {%- endif -%}

    <div class="collection collection--empty page-width" id="product-grid-{{ section.id }}">
      <div class="loading-overlay gradient"></div>

      <ul class="grid product-grid contains-card contains-card--product grid--{{ products_per_row }}-col-desktop grid--{{ section.settings.columns_mobile }}-col-tablet-down" 
          role="list" 
          aria-labelledby="SectionHeading-{{ section.id }}">
        
        {%- for block in section.blocks -%}
          {%- assign product = block.settings.product -%}
          {%- if product != blank -%}
            <li class="grid__item" {{ block.shopify_attributes }}>
              {% render 'card-product',
                card_product: product,
                media_aspect_ratio: image_ratio,
                image_shape: section.settings.image_shape,
                show_secondary_image: section.settings.show_secondary_image,
                show_vendor: show_vendor,
                show_rating: show_rating,
                lazy_load: true,
                show_quick_add: show_quick_buy,
                section_id: section.id
              %}
            </li>
          {%- else -%}
            <li class="grid__item">
              <div class="card-wrapper underline-links-hover">
                <div class="card card--{{ section.settings.image_shape }} card--text color-{{ section.settings.color_scheme }} gradient">
                  <div class="card__content">
                    <div class="card__information">
                      <h3 class="card__heading">
                        <span class="visually-hidden">{{ 'sections.featured_product.onboarding.title' | t }}</span>
                      </h3>
                      <div class="card-information">
                        <span class="caption-large light">{{ 'sections.featured_product.onboarding.no_product_selected' | t }}</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </li>
          {%- endif -%}
        {%- endfor -%}
      </ul>
    </div>
  </div>
</div>

<style>
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }

  .product-grid-section__description {
    margin-top: 1rem;
    margin-bottom: 2rem;
  }

  @media screen and (min-width: 750px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }

  /* Target the product grid directly */
  #product-grid-{{ section.id }} .product-grid {
    gap: {{ section.settings.grid_gap }}px;
    align-items: {{ section.settings.align_items }};
  }

  /* Grid container alignment */
  #product-grid-{{ section.id }} .collection {
    display: flex;
    justify-content: {{ section.settings.justify_content }};
  }

  /* Target cards within this specific product grid */
  #product-grid-{{ section.id }} .card {
    height: 100%;
    text-align: {{ section.settings.card_text_align }};
  }

  /* Only apply flex direction to card content, not the grid */
  #product-grid-{{ section.id }} .card__content {
    display: flex;
    flex-direction: {{ section.settings.flex_direction }};
    height: 100%;
  }

  #product-grid-{{ section.id }} .card__information {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
  }

  /* Horizontal card layout adjustments */
  {%- if section.settings.flex_direction == 'row' or section.settings.flex_direction == 'row-reverse' -%}
    #product-grid-{{ section.id }} .card__content {
      align-items: flex-start;
    }
    #product-grid-{{ section.id }} .card__information {
      flex-direction: column;
      padding-left: 1rem;
    }
    #product-grid-{{ section.id }} .card__media {
      flex: 0 0 40%;
      max-width: 40%;
    }
  {%- endif -%}

  /* Text alignment for all card content */
  #product-grid-{{ section.id }} .card__heading,
  #product-grid-{{ section.id }} .card-information,
  #product-grid-{{ section.id }} .price,
  #product-grid-{{ section.id }} .quick-add {
    text-align: {{ section.settings.card_text_align }};
  }
</style>

{% schema %}
{
  "name": "Custom Product Grid",
  "tag": "section",
  "class": "section",
  "disabled_on": {
    "groups": ["header", "footer"]
  },
  "settings": [
    {
      "type": "inline_richtext",
      "id": "title",
      "default": "Featured Products",
      "label": "Heading"
    },
    {
      "type": "select",
      "id": "heading_size",
      "options": [
        {
          "value": "h2",
          "label": "Small"
        },
        {
          "value": "h1",
          "label": "Medium"
        },
        {
          "value": "h0",
          "label": "Large"
        }
      ],
      "default": "h1",
      "label": "Heading size"
    },
    {
      "type": "richtext",
      "id": "description",
      "label": "Description"
    },
    {
      "type": "range",
      "id": "products_per_row",
      "min": 1,
      "max": 5,
      "step": 1,
      "default": 4,
      "label": "Number of columns on desktop"
    },
    {
      "type": "select",
      "id": "columns_mobile",
      "default": "2",
      "label": "Number of columns on mobile",
      "options": [
        {
          "value": "1",
          "label": "1 column"
        },
        {
          "value": "2",
          "label": "2 columns"
        }
      ]
    },
    {
      "type": "range",
      "id": "grid_gap",
      "min": 0,
      "max": 50,
      "step": 2,
      "unit": "px",
      "label": "Grid gap",
      "default": 20
    },
    {
      "type": "header",
      "content": "Layout control"
    },
    {
      "type": "select",
      "id": "flex_direction",
      "options": [
        {
          "value": "row",
          "label": "Horizontal (Row)"
        },
        {
          "value": "column",
          "label": "Vertical (Column)"
        },
        {
          "value": "row-reverse",
          "label": "Horizontal Reverse"
        },
        {
          "value": "column-reverse",
          "label": "Vertical Reverse"
        }
      ],
      "default": "row",
      "label": "Card content direction",
      "info": "Controls how content flows within each product card"
    },
    {
      "type": "select",
      "id": "justify_content",
      "options": [
        {
          "value": "flex-start",
          "label": "Start"
        },
        {
          "value": "center",
          "label": "Center"
        },
        {
          "value": "flex-end",
          "label": "End"
        },
        {
          "value": "space-between",
          "label": "Space Between"
        },
        {
          "value": "space-around",
          "label": "Space Around"
        },
        {
          "value": "space-evenly",
          "label": "Space Evenly"
        }
      ],
      "default": "flex-start",
      "label": "Grid alignment",
      "info": "Controls how products are aligned within the grid container"
    },
    {
      "type": "select",
      "id": "align_items",
      "options": [
        {
          "value": "stretch",
          "label": "Stretch (Equal Height)"
        },
        {
          "value": "flex-start",
          "label": "Top"
        },
        {
          "value": "center",
          "label": "Center"
        },
        {
          "value": "flex-end",
          "label": "Bottom"
        },
        {
          "value": "baseline",
          "label": "Baseline"
        }
      ],
      "default": "stretch",
      "label": "Vertical alignment",
      "info": "Controls vertical alignment of products in the grid"
    },
    {
      "type": "select",
      "id": "card_text_align",
      "options": [
        {
          "value": "left",
          "label": "Left"
        },
        {
          "value": "center",
          "label": "Center"
        },
        {
          "value": "right",
          "label": "Right"
        }
      ],
      "default": "left",
      "label": "Card text alignment"
    },
    {
      "type": "header",
      "content": "Product card settings"
    },
    {
      "type": "select",
      "id": "image_ratio",
      "options": [
        {
          "value": "adapt",
          "label": "Adapt to image"
        },
        {
          "value": "portrait",
          "label": "Portrait"
        },
        {
          "value": "square",
          "label": "Square"
        }
      ],
      "default": "adapt",
      "label": "Image ratio"
    },
    {
      "type": "select",
      "id": "image_shape",
      "options": [
        {
          "value": "default",
          "label": "Default"
        },
        {
          "value": "arch",
          "label": "Arch"
        },
        {
          "value": "blob",
          "label": "Blob"
        },
        {
          "value": "chevronleft",
          "label": "Chevron left"
        },
        {
          "value": "chevronright",
          "label": "Chevron right"
        },
        {
          "value": "diamond",
          "label": "Diamond"
        },
        {
          "value": "parallelogram",
          "label": "Parallelogram"
        },
        {
          "value": "round",
          "label": "Round"
        }
      ],
      "default": "default",
      "label": "Image shape"
    },
    {
      "type": "checkbox",
      "id": "show_secondary_image",
      "default": false,
      "label": "Show second product image on hover"
    },
    {
      "type": "checkbox",
      "id": "show_vendor",
      "default": false,
      "label": "Show product vendor"
    },
    {
      "type": "checkbox",
      "id": "show_rating",
      "default": false,
      "label": "Show product rating",
      "info": "To display a rating, add a product rating app. [Learn more](https://help.shopify.com/manual/online-store/themes/theme-structure/theme-features#featured-collection-show-product-rating)"
    },
    {
      "type": "checkbox",
      "id": "show_quick_buy",
      "default": true,
      "label": "Enable quick add"
    },
    {
      "type": "header",
      "content": "t:sections.all.colors.settings.header.content"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:sections.all.colors.label",
      "default": "background-1"
    },
    {
      "type": "header",
      "content": "t:sections.all.padding.section_padding_heading"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "t:sections.all.padding.padding_top",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "t:sections.all.padding.padding_bottom",
      "default": 36
    }
  ],
  "blocks": [
    {
      "type": "product",
      "name": "Product",
      "settings": [
        {
          "type": "product",
          "id": "product",
          "label": "Product"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Custom Product Grid",
      "blocks": [
        {
          "type": "product"
        },
        {
          "type": "product"
        },
        {
          "type": "product"
        },
        {
          "type": "product"
        }
      ]
    }
  ]
}
{% endschema %}