{% capture announcement_copy %}
  {%- if section.settings.heading != blank -%}
    {%- if section.settings.link != blank -%}
      <a href="{{ section.settings.link }}" class="announcement-bar__announcement announcement-bar__link link--with-arrow line-height--heading motion-reduce">
        {{ section.settings.heading | escape }}
        {%- render 'icons', icon: 'arrow', size: '1em', class: 'link__arrow' -%}
      </a>
    {%- else -%}
      <span class="announcement-bar__announcement line-height--heading">
        {{ section.settings.heading | escape }}
      </span>
    {%- endif -%}
  {%- endif -%}
{% endcapture %}

{%- if section.settings.link != blank-%}
  {% capture announcement_copy_link_hidden %}
    <a href="{{ section.settings.link }}" class="announcement-bar__announcement announcement-bar__link link--with-arrow line-height--heading motion-reduce" tabindex="-1">
      {{ section.settings.heading | escape }}
      {%- render 'icons', icon: 'arrow', size: '1em', class: 'link__arrow' -%}
    </a>
  {% endcapture %}
{%- endif -%}

{%- if section.settings.enable_marquee -%}
  <script src="{{ 'full-width-element.js' | asset_url }}" async></script>
{%- endif -%}

{%- liquid 
  assign marquee_speed = section.settings.marquee_speed | times: 20
-%}

<style>
  .announcement-bar__link:focus-visible {
    --box-shadow-color: hsla({{ section.settings.color_text.hue }}, {{ section.settings.color_text.saturation }}%, {{ section.settings.color_text.lightness }}%, 0.7);
  }

  .announcement-bar__link {
    --color-link: {{ section.settings.color_text }};
    --color-link-raw: {{ section.settings.color_text.hue }}, {{ section.settings.color_text.saturation }}%, {{ section.settings.color_text.lightness }}%;
  }

  .announcement-bar__marquee {
    --marquee-speed: {{ marquee_speed }}s;
    --marquee-gap: {{ section.settings.marquee_gap }}px;
  }
</style>

{%- if section.settings.show_announcement_bar -%}
  <div class="announcement-bar section-{{ section.id }}" id="announcement-bar" role="region" aria-label="{{ 'header.announcement' | t }}">
    <div class="announcement-bar__container copy--{{ section.settings.text_size }} {% if section.settings.font_style == 'heading' %}type--heading{% elsif section.settings.font_style == 'accent' %}type--accent{% endif %} {% if section.settings.font_bold %}copy--bold{% endif %}" style="background: {{ section.settings.color_bg }}; color: {{ section.settings.color_text }}; padding-top: {{ section.settings.padding_top_bottom }}px; padding-bottom: {{ section.settings.padding_top_bottom }}px;">
      {%- if section.settings.enable_marquee -%}
        <full-width-element class="announcement-bar__marquee marquee marquee--pause-on-hover" id="announcement-bar">
          <div class="marquee__content">
            {{ announcement_copy }}
            {{ announcement_copy }}
            {{ announcement_copy }}
            {{ announcement_copy }}
            {{ announcement_copy }}
            {{ announcement_copy }}
            {{ announcement_copy }}
            {{ announcement_copy }}
            {{ announcement_copy }}
            {{ announcement_copy }}
          </div>
          <div class="marquee__content" aria-hidden="true">
            {%- if section.settings.link == blank-%}
              {{ announcement_copy }}
              {{ announcement_copy }}
              {{ announcement_copy }}
              {{ announcement_copy }}
              {{ announcement_copy }}
              {{ announcement_copy }}
              {{ announcement_copy }}
              {{ announcement_copy }}
              {{ announcement_copy }}
              {{ announcement_copy }}
            {%- else -%}
              {{ announcement_copy_link_hidden }}
              {{ announcement_copy_link_hidden }}
              {{ announcement_copy_link_hidden }}
              {{ announcement_copy_link_hidden }}
              {{ announcement_copy_link_hidden }}
              {{ announcement_copy_link_hidden }}
              {{ announcement_copy_link_hidden }}
              {{ announcement_copy_link_hidden }}
              {{ announcement_copy_link_hidden }}
              {{ announcement_copy_link_hidden }}
            {%- endif -%}
          </div>
        </full-width-element>
      {%- else -%}
        <div class="announcement-bar__static">
          {{ announcement_copy }}
        </div>
      {%- endif -%}
    </div>
  </div>

  <style>
    {% render 'layout-css', section: section %}
  </style>
{%- endif -%}

{% schema %}
{
  "name": "Announcement Bar",
  "tag": "section",
  "class": "section--announcement-bar",
  "enabled_on": {
    "groups": ["header", "footer"],
    "templates": ["*"]
  },
  "settings": [
    {
      "type": "checkbox",
      "id": "show_announcement_bar",
      "label": "Show Announcement Bar",
      "default": true
    },
    {
      "type": "text",
      "id": "heading",
      "default": "Welcome to our store",
      "label": "Announcement Text"
    },
    {
      "type": "url",
      "id": "link",
      "label": "Link (Optional)"
    },
    {
      "type": "color_background",
      "id": "color_bg",
      "label": "Background Color",
      "default": "linear-gradient(335deg, rgba(216, 241, 244, 1) 3%, rgba(186, 203, 247, 1) 90%)"
    },
    {
      "type": "color",
      "id": "color_text",
      "label": "Text Color",
      "default": "#000000"
    },
    {
      "type": "select",
      "id": "font_style",
      "options": [
        {
          "value": "body",
          "label": "Body"
        },
        {
          "value": "heading",
          "label": "Heading"
        },
        {
          "value": "accent",
          "label": "Accent"
        }
      ],
      "default": "body",
      "label": "Font Style"
    },
    {
      "type": "select",
      "id": "text_size",
      "options": [
        {
          "value": "large",
          "label": "Large"
        },
        {
          "value": "medium",
          "label": "Medium"
        },
        {
          "value": "small",
          "label": "Small"
        },
        {
          "value": "xsmall",
          "label": "Extra Small"
        }
      ],
      "default": "medium",
      "label": "Text Size"
    },
    {
      "type": "checkbox",
      "id": "font_bold",
      "default": false,
      "label": "Bold Font"
    },
    {
      "type": "header",
      "content": "Marquee Settings"
    },
    {
      "type": "checkbox",
      "id": "enable_marquee",
      "default": false,
      "label": "Enable Scrolling Marquee"
    },
    {
      "type": "range",
      "id": "marquee_speed",
      "min": 1,
      "max": 10,
      "step": 1,
      "label": "Marquee Speed",
      "default": 5
    },
    {
      "type": "range",
      "id": "marquee_gap",
      "min": 10,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 20,
      "label": "Marquee Gap"
    },
    {
      "type": "header",
      "content": "Spacing"
    },
    {
      "type": "range",
      "id": "padding_top_bottom",
      "min": 0,
      "max": 10,
      "step": 1,
      "unit": "px",
      "default": 5,
      "label": "Top/Bottom Padding"
    },
    {% render 'layout-settings' %}
  ]
}
{% endschema %}