{% capture announcement_copy %}
  {%- if section.settings.heading != blank -%}
    {%- if section.settings.link != blank -%}
      <a href="{{ section.settings.link }}" class="announcement-bar__announcement announcement-bar__link link--with-arrow line-height--heading motion-reduce">
        {{ section.settings.heading | escape }}
        {%- render 'icons', icon: 'arrow', size: '1em', class: 'link__arrow' -%}
      </a>
    {%- else -%}
      <span class="announcement-bar__announcement line-height--heading">
        {{ section.settings.heading | escape }}
      </span>
    {%- endif -%}
  {%- endif -%}
{% endcapture %}

{%- if section.settings.link != blank-%}
  {% capture announcement_copy_link_hidden %}
    <a href="{{ section.settings.link }}" class="announcement-bar__announcement announcement-bar__link link--with-arrow line-height--heading motion-reduce" tabindex="-1">
      {{ section.settings.heading | escape }}
      {%- render 'icons', icon: 'arrow', size: '1em', class: 'link__arrow' -%}
    </a>
  {% endcapture %}
{%- endif -%}

{%- if section.settings.enable_marquee -%}
  <script src="{{ 'full-width-element.js' | asset_url }}" async></script>
{%- endif -%}

{%- liquid 
  assign marquee_speed = section.settings.marquee_speed | times: 20
-%}

<style>
  .announcement-bar__link:focus-visible {
    --box-shadow-color: hsla({{ section.settings.color_text.hue }}, {{ section.settings.color_text.saturation }}%, {{ section.settings.color_text.lightness }}%, 0.7);
  }

  .announcement-bar__link {
    --color-link: {{ section.settings.color_text }};
    --color-link-raw: {{ section.settings.color_text.hue }}, {{ section.settings.color_text.saturation }}%, {{ section.settings.color_text.lightness }}%;
  }

  .announcement-bar__marquee {
    --marquee-speed: {{ marquee_speed }}s;
    --marquee-gap: {{ section.settings.marquee_gap }}px;
  }
</style>

{%- if section.settings.show_announcement_bar -%}
  <div class="announcement-bar section-{{ section.id }}" id="announcement-bar" role="region" aria-label="{{ 'header.announcement' | t }}">
    <div class="announcement-bar__container copy--{{ section.settings.text_size }} {% if section.settings.font_style == 'heading' %}type--heading{% elsif section.settings.font_style == 'accent' %}type--accent{% endif %} {% if section.settings.font_bold %}copy--bold{% endif %}" style="background: {{ section.settings.color_bg }}; color: {{ section.settings.color_text }}; padding-top: {{ section.settings.padding_top_bottom }}px; padding-bottom: {{ section.settings.padding_top_bottom }}px;">
      {%- if section.settings.enable_marquee -%}
        <full-width-element class="announcement-bar__marquee marquee marquee--pause-on-hover" id="announcement-bar">
          <div class="marquee__content">
            {{ announcement_copy }}
            {{ announcement_copy }}
            {{ announcement_copy }}
            {{ announcement_copy }}
            {{ announcement_copy }}
            {{ announcement_copy }}
            {{ announcement_copy }}
            {{ announcement_copy }}
            {{ announcement_copy }}
            {{ announcement_copy }}
          </div>
          <div class="marquee__content" aria-hidden="true">
            {%- if section.settings.link == blank-%}
              {{ announcement_copy }}
              {{ announcement_copy }}
              {{ announcement_copy }}
              {{ announcement_copy }}
              {{ announcement_copy }}
              {{ announcement_copy }}
              {{ announcement_copy }}
              {{ announcement_copy }}
              {{ announcement_copy }}
              {{ announcement_copy }}
            {%- else -%}
              {{ announcement_copy_link_hidden }}
              {{ announcement_copy_link_hidden }}
              {{ announcement_copy_link_hidden }}
              {{ announcement_copy_link_hidden }}
              {{ announcement_copy_link_hidden }}
              {{ announcement_copy_link_hidden }}
              {{ announcement_copy_link_hidden }}
              {{ announcement_copy_link_hidden }}
              {{ announcement_copy_link_hidden }}
              {{ announcement_copy_link_hidden }}
            {%- endif -%}
          </div>
        </full-width-element>
      {%- else -%}
        <div class="announcement-bar__static">
          {{ announcement_copy }}
        </div>
      {%- endif -%}
    </div>
  </div>

  <style>
    {% render 'layout-css', section: section %}
  </style>
{%- endif -%}

{% schema %}
{
  "name": "t:announcement_bar.name",
  "tag": "section",
  "class": "section--announcement-bar",
  "settings": [
    {
      "type": "checkbox",
      "id": "show_announcement_bar",
      "label": "t:announcement_bar.settings.show_announcement_bar.label",
      "default": true
    },
    {
      "type": "text",
      "id": "heading",
      "default": "Welcome to our store",
      "label": "t:text.label"
    },
    {
      "type": "url",
      "id": "link",
      "label": "t:link.label_optional"
    },
    {
      "type": "color_background",
      "id": "color_bg",
      "label": "t:background.label",
      "default": "linear-gradient(335deg, rgba(216, 241, 244, 1) 3%, rgba(186, 203, 247, 1) 90%)"
    },
    {
      "type": "color",
      "id": "color_text",
      "label": "t:font_color.label",
      "default": "#000000"
    },
    {
      "type": "select",
      "id": "font_style",
      "options": [
        {
          "value": "body",
          "label": "t:typography.settings.font_style.option_body"
        },
        {
          "value": "heading",
          "label": "t:typography.settings.font_style.option_heading"
        },
        {
          "value": "accent",
          "label": "t:typography.settings.font_style.option_accent"
        }
      ],
      "default": "body",
      "label": "t:typography.settings.font_style.label"
    },
    {
      "type": "select",
      "id": "text_size",
      "options": [
        {
          "value": "large",
          "label": "t:text.settings.text_size.option_large"
        },
        {
          "value": "medium",
          "label": "t:text.settings.text_size.option_medium"
        },
        {
          "value": "small",
          "label": "t:text.settings.text_size.option_small"
        },
        {
          "value": "xsmall",
          "label": "t:text.settings.text_size.option_xsmall"
        }
      ],
      "default": "medium",
      "label": "t:text.settings.text_size.label"
    },
    {
      "type": "checkbox",
      "id": "font_bold",
      "default": false,
      "label": "t:typography.settings.bold_font.label"
    },
    {
      "type": "header",
      "content": "t:marquee.header"
    },
    {
      "type": "checkbox",
      "id": "enable_marquee",
      "default": false,
      "label": "t:marquee.settings.enable_marquee.label"
    },
    {
      "type": "range",
      "id": "marquee_speed",
      "min": 1,
      "max": 10,
      "step": 1,
      "label": "t:marquee.settings.marquee_speed.label",
      "default": 5
    },
    {
      "type": "range",
      "id": "marquee_gap",
      "min": 10,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 20,
      "label": "t:marquee.settings.marquee_gap.label"
    },
    {
      "type": "header",
      "content": "t:spacing.name"
    },
    {
      "type": "range",
      "id": "padding_top_bottom",
      "min": 0,
      "max": 10,
      "step": 1,
      "unit": "px",
      "default": 5,
      "label": "t:spacing.settings.padding_top_bottom.label"
    },
    {% render 'layout-settings' %}
  ]
}
{% endschema %}